<!DOCTYPE html>
<html lang="ko-KR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width" />
  <script
    type="application/javascript"
    src='https://pink-spider.github.io/js/theme-mode.js'
  ></script>
  <link rel="stylesheet" href='https://pink-spider.github.io/css/frameworks.min.css' />
  <link rel="stylesheet" href='https://pink-spider.github.io/css/github.min.css' />
  <link rel="stylesheet" href='https://pink-spider.github.io/css/github-style.css' />
  <link rel="stylesheet" href='https://pink-spider.github.io/css/light.css' />
  <link rel="stylesheet" href='https://pink-spider.github.io/css/dark.css' />
  <link rel="stylesheet" href='https://pink-spider.github.io/css/syntax.css' />
  
  <link rel="stylesheet" href="/your%20css%20file%20name" />
  
  <title>
    DB Shading | Pink Spider
  </title>
  
  <link rel="icon" type="image/x-icon" href="/images/logo_pinkspider.png" />
  
  <meta name="theme-color" content="#1e2327" />

  
  <meta
  name="description"
  content="데이터베이스(DB) 샤딩(DB Sharding)이란 대용량 데이터를 효율적으로 분산·관리하기 위해 하나의 거대한 데이터베이스를 여러 개의 작은 조각(샤드, shard)으로 나누어 각각을 별도의 서버에 분산 저장하고 처리하는 기법을 말합니다.
1. 왜 샤딩이 필요한가? 성능 확장성(Scalability)
단일 서버에 모든 데이터를 저장하면 저장 용량·처리 능력이 한계에 부딪힙니다. 데이터와 트래픽이 늘어날수록 로드가 집중되어 응답 지연(latency)이나 병목(bottleneck)이 발생합니다. 고가용성(High Availability)
각 샤드를 독립된 노드에 두면, 일부 노드 장애 시에도 전체 시스템이 완전히 다운되지 않고 가용성을 유지할 수 있습니다. 관리 용이성
"
/>
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://pink-spider.github.io/post/til/db_shading/" />


<meta name="twitter:card" content="summary" />
<meta
  name="twitter:title"
  content="DB Shading - Pink Spider"
/>
<meta
  name="twitter:description"
  content="데이터베이스(DB) 샤딩(DB Sharding)이란 대용량 데이터를 효율적으로 분산·관리하기 위해 하나의 거대한 데이터베이스를 여러 개의 작은 조각(샤드, shard)으로 나누어 각각을 별도의 서버에 분산 저장하고 처리하는 기법을 말합니다.
1. 왜 샤딩이 필요한가? 성능 확장성(Scalability)
단일 서버에 모든 데이터를 저장하면 저장 용량·처리 능력이 한계에 부딪힙니다. 데이터와 트래픽이 늘어날수록 로드가 집중되어 응답 지연(latency)이나 병목(bottleneck)이 발생합니다. 고가용성(High Availability)
각 샤드를 독립된 노드에 두면, 일부 노드 장애 시에도 전체 시스템이 완전히 다운되지 않고 가용성을 유지할 수 있습니다. 관리 용이성
"
/>
<meta name="twitter:site" content="https://pink-spider.github.io/" />
<meta name="twitter:creator" content="" />
<meta
  name="twitter:image"
  content="https://pink-spider.github.io/"
/>


<meta
  property="og:type"
  content="article"
/>
<meta
  property="og:title"
  content="DB Shading - Pink Spider"
/>
<meta
  property="og:description"
  content="데이터베이스(DB) 샤딩(DB Sharding)이란 대용량 데이터를 효율적으로 분산·관리하기 위해 하나의 거대한 데이터베이스를 여러 개의 작은 조각(샤드, shard)으로 나누어 각각을 별도의 서버에 분산 저장하고 처리하는 기법을 말합니다.
1. 왜 샤딩이 필요한가? 성능 확장성(Scalability)
단일 서버에 모든 데이터를 저장하면 저장 용량·처리 능력이 한계에 부딪힙니다. 데이터와 트래픽이 늘어날수록 로드가 집중되어 응답 지연(latency)이나 병목(bottleneck)이 발생합니다. 고가용성(High Availability)
각 샤드를 독립된 노드에 두면, 일부 노드 장애 시에도 전체 시스템이 완전히 다운되지 않고 가용성을 유지할 수 있습니다. 관리 용이성
"
/>
<meta property="og:url" content="https://pink-spider.github.io/post/til/db_shading/" />
<meta property="og:site_name" content="DB Shading" />
<meta
  property="og:image"
  content="https://pink-spider.github.io/"
/>
<meta property="og:image:width" content="2048" />
<meta property="og:image:height" content="1024" />

<meta property="article:published_time" content="2025-06-10 08:44:58 &#43;0900 KST" />















</head>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6329038356545416"
        crossorigin="anonymous"></script>

<body>
  

<style>
  .height-limitation {
    max-height: 300px;
    overflow-y: scroll;
  }

  .loader {
    border: 4px solid #f3f3f3;
    border-bottom: 4px solid var(--color-fg-muted);
    border-radius: 50%;
    width: 30px;
    height: 30px;
    animation: spin 1s linear infinite;
    margin: 0 auto;
  }

  @keyframes spin {
    0% {
      transform: rotate(0deg);
    }
    100% {
      transform: rotate(360deg);
    }
  }
</style>

<div style="position: relative">
  <header
    class="Header js-details-container Details px-3 px-md-4 px-lg-5 flex-wrap flex-md-nowrap open Details--on"
  >
    <div
      class="Header-item mobile-none"
      style="margin-top: -4px; margin-bottom: -4px"
    >
      <a class="Header-link" href="https://pink-spider.github.io/" aria-label="Home">
        <svg
          class="octicon"
          height="32"
          viewBox="0 0 16 16"
          version="1.1"
          width="32"
        >
          <path
            fill-rule="evenodd"
            d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"
          ></path>
        </svg>
      </a>
    </div>
    <div class="Header-item d-md-none">
      <button
        class="Header-link btn-link js-details-target"
        type="button"
        onclick="document.querySelector('#header-search').style.display = document.querySelector('#header-search').style.display == 'none'? 'block': 'none'"
        aria-label="Search"
      >
        <svg
          height="24"
          class="octicon octicon-three-bars"
          viewBox="0 0 16 16"
          version="1.1"
          width="24"
        >
          <path
            fill-rule="evenodd"
            d="M1 2.75A.75.75 0 011.75 2h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 2.75zm0 5A.75.75 0 011.75 7h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 7.75zM1.75 12a.75.75 0 100 1.5h12.5a.75.75 0 100-1.5H1.75z"
          ></path>
        </svg>
      </button>
    </div>
    <div
      style="display: none"
      id="header-search"
      class="Header-item Header-item--full flex-column flex-md-row width-full flex-order-2 flex-md-order-none mr-0 mr-md-3 mt-3 mt-md-0 Details-content--hidden-not-important d-md-flex"
    >
      <div
        class="Header-search header-search flex-auto js-site-search position-relative flex-self-stretch flex-md-self-auto mb-3 mb-md-0 mr-0 mr-md-3 scoped-search site-scoped-search js-jump-to"
      >
        <div class="position-relative">
          <form
            target="_blank"
            action="https://www.google.com/search"
            accept-charset="UTF-8"
            method="get"
            autocomplete="off"
          >
            <label
              class="Header-search-label form-control input-sm header-search-wrapper p-0 js-chromeless-input-container header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center"
            >
              <input
                type="text"
                class="Header-search-input form-control input-sm header-search-input jump-to-field js-jump-to-field js-site-search-focus js-site-search-field is-clearable"
                name="q"
                value=""
                placeholder="Search"
                autocomplete="off"
              />
              <input type="hidden" name="q" value="site:https://pink-spider.github.io/" />
              <div
                class="js-jump-to-suggestions-container jump-to-suggestions overflow-hidden position-absolute"
              >
                <div
                  id="search-progress"
                  class="d-none color-bg-primary no-underline p-2"
                  role="progress"
                  aria-selected="false"
                >
                  <div class="loader"></div>
                </div>

                <ul
                  id="jump-to-results"
                  role="listbox"
                  class="Box border-0 p-0 m-0 js-navigation-container jump-to-suggestions-results-container js-jump-to-suggestions-results-container js-active-navigation-container height-limitation"
                ></ul>
              </div>
            </label>
          </form>
        </div>
      </div>
    </div>

    <div
      class="Header-item Header-item--full flex-justify-center d-md-none position-relative"
    >
      <a class="Header-link" href="https://pink-spider.github.io/" aria-label="Home">
        <svg
          class="octicon octicon-mark-github v-align-middle"
          height="32"
          viewBox="0 0 16 16"
          version="1.1"
          width="32"
        >
          <path
            fill-rule="evenodd"
            d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"
          ></path>
        </svg>
      </a>
    </div>
    <div class="Theme-switcher Header-item" style="margin-right: 0">
      <span
        role="button"
        class="Header-link no-select"
        onclick="switchTheme()"
        style="cursor: pointer"
        aria-label="Switch theme"
      >
        <svg
          style="fill: var(--color-profile-color-modes-toggle-moon)"
          class="no-select"
          viewBox="0 0 16 16"
          version="1.1"
          width="16"
          height="16"
        >
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M4.52208 7.71754C7.5782 7.71754 10.0557 5.24006 10.0557 2.18394C10.0557 1.93498 10.0392 1.68986 10.0074 1.44961C9.95801 1.07727 10.3495 0.771159 10.6474 0.99992C12.1153 2.12716 13.0615 3.89999 13.0615 5.89383C13.0615 9.29958 10.3006 12.0605 6.89485 12.0605C3.95334 12.0605 1.49286 10.001 0.876728 7.24527C0.794841 6.87902 1.23668 6.65289 1.55321 6.85451C2.41106 7.40095 3.4296 7.71754 4.52208 7.71754Z"
          ></path>
        </svg>
      </span>
    </div>
  </header>
</div>

  
<div>
  <main>
    <div class="gisthead pagehead bg-gray-light pb-0 pt-3 mb-4">
      <div class="px-0">
        <div class="mb-3 d-flex px-3 px-md-3 px-lg-5">
          <div class="flex-auto min-width-0 width-fit mr-3">
            <div class="d-flex">
              <div class="d-none d-md-block">
                <a class="avatar mr-2 flex-shrink-0" href="https://pink-spider.github.io/">
                  <img class=" avatar-user"
                    src="/images/logo_pinkspider.png"
                    width="32" height="32" alt="Pink Spider"></a>
              </div>
              <div class="d-flex flex-column">
                <h1 class="break-word f3 text-normal mb-md-0 mb-1">
                  <span class="author">
                    <a href="https://pink-spider.github.io/">Pink Spider</a></span><span
                    class="path-divider">/</span><strong class="css-truncate-target mr-1" style="max-width: 410px"><a
                      href="https://pink-spider.github.io/post/til/db_shading/">DB Shading</a></strong>
                </h1>
                <div class="note m-0">
                  Created <relative-time datetime="Tue, 10 Jun 2025 08:44:58 &#43;0900"
                    class="no-wrap">
                    Tue, 10 Jun 2025 08:44:58 &#43;0900</relative-time>

                  
                  <span class="file-info-divider"></span>
                  Modified <relative-time datetime="Tue, 10 Jun 2025 08:45:03 &#43;0900"
                    class="no-wrap">
                    Tue, 10 Jun 2025 08:45:03 &#43;0900</relative-time>
                  
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container-lg px-3 new-discussion-timeline">
      <div class="repository-content gist-content">
        <div>
          <div class="js-gist-file-update-container js-task-list-container file-box">
            <div id="file-pytest" class="file my-2">
              <div id="post-header" class="file-header d-flex flex-md-items-center flex-items-start sticky-header" style="z-index: 2">
                <div class="file-info d-flex flex-md-items-center flex-items-start flex-order-1 flex-auto">
                  <div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">
                    
                    <summary id="toc-toggle" onclick="clickToc()" class="btn btn-octicon m-0 mr-2 p-2">
                      <svg aria-hidden="true" viewBox="0 0 16 16" height="16" width="16" class="octicon octicon-list-unordered">
                        <path fill-rule="evenodd" d="M2 4a1 1 0 100-2 1 1 0 000 2zm3.75-1.5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zM3 8a1 1 0 11-2 0 1 1 0 012 0zm-1 6a1 1 0 100-2 1 1 0 000 2z"></path>
                      </svg>
                    </summary>
                    <details-menu class="SelectMenu" id="toc-details" style="display: none;">
                      <div class="SelectMenu-modal rounded-3 mt-1" style="max-height: 340px;">
                        <div class="SelectMenu-list SelectMenu-list--borderless p-2" style="overscroll-behavior: contain;" id="toc-list">
                        </div>
                      </div>
                    </details-menu>
                      3489 Words
                    <span class="file-info-divider"></span>
                                        16 min

                  </div>
                  <div class="file-actions flex-order-2 pt-0">
                    
                  </div>
                </div>
              </div>


              <div class="Box-body px-5 pb-5" style="z-index: 1">
                <article class="markdown-body entry-content container-lg"><p>데이터베이스(DB) 샤딩(DB Sharding)이란 대용량 데이터를 효율적으로 분산·관리하기 위해 하나의 거대한 데이터베이스를 여러 개의 작은 조각(샤드, shard)으로 나누어 각각을 별도의 서버에 분산 저장하고 처리하는 기법을 말합니다.</p>
<hr>
<h2 id="1-왜-샤딩이-필요한가">1. 왜 샤딩이 필요한가?</h2>
<ul>
<li>
<p><strong>성능 확장성(Scalability)</strong></p>
<ul>
<li>단일 서버에 모든 데이터를 저장하면 저장 용량·처리 능력이 한계에 부딪힙니다.</li>
<li>데이터와 트래픽이 늘어날수록 로드가 집중되어 응답 지연(latency)이나 병목(bottleneck)이 발생합니다.</li>
</ul>
</li>
<li>
<p><strong>고가용성(High Availability)</strong></p>
<ul>
<li>각 샤드를 독립된 노드에 두면, 일부 노드 장애 시에도 전체 시스템이 완전히 다운되지 않고 가용성을 유지할 수 있습니다.</li>
</ul>
</li>
<li>
<p><strong>관리 용이성</strong></p>
<ul>
<li>데이터 규모가 커질수록 백업·복구·마이그레이션 같은 운영 작업이 어려워지는데, 샤딩으로 작은 단위로 나누면 관리 부담을 줄일 수 있습니다.</li>
</ul>
</li>
</ul>
<hr>
<h2 id="2-샤딩-방식">2. 샤딩 방식</h2>
<ol>
<li>
<p><strong>범위 기반 샤딩(Range Sharding)</strong></p>
<ul>
<li>특정 컬럼(예: 사용자 ID나 날짜)을 기준으로 값의 범위별로 샤드를 나눕니다.</li>
<li>예: ID 1–1,000 → 샤드 A, 1,001–2,000 → 샤드 B</li>
</ul>
</li>
<li>
<p><strong>해시 기반 샤딩(Hash Sharding)</strong></p>
<ul>
<li>샤드 키(보통 프라이머리 키)에 해시 함수를 적용해 결과값을 샤드 수로 나눈 나머지로 저장 위치를 결정합니다.</li>
<li>분포가 균일해지는 장점이 있으나, 범위 검색 시 모든 샤드를 조회해야 할 수 있습니다.</li>
</ul>
</li>
<li>
<p><strong>디렉터리 기반 샤딩(Directory Sharding)</strong></p>
<ul>
<li>중앙에 샤드 매핑 테이블을 두어, 각 레코드가 어느 샤드에 있는지 직접 매핑 관리합니다.</li>
<li>유연하지만 매핑 테이블이 병목이 될 수 있습니다.</li>
</ul>
</li>
</ol>
<hr>
<h2 id="3-장단점">3. 장단점</h2>
<table>
  <thead>
      <tr>
          <th>구분</th>
          <th>장점</th>
          <th>단점</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>성능</td>
          <td>읽기·쓰기 부하를 여러 노드로 분산 → 처리량 증가</td>
          <td>샤딩 키 설계 실패 시 불균형(Hot Spot) 발생 위험</td>
      </tr>
      <tr>
          <td>가용성</td>
          <td>일부 노드만 장애 → 시스템 전체는 계속 운영 가능</td>
          <td>네트워크 분산 환경 → 트랜잭션 관리(분산 트랜잭션)가 복잡해짐</td>
      </tr>
      <tr>
          <td>확장성</td>
          <td>샤드 추가만으로 수평적 확장(horizontal scaling) 가능</td>
          <td>샤드 추가·삭제 시 데이터 재분배(Rebalancing) 비용 발생</td>
      </tr>
      <tr>
          <td>운영 복잡도</td>
          <td>–</td>
          <td>모니터링·백업·백오프 등 운영 복잡도 증가</td>
      </tr>
  </tbody>
</table>
<hr>
<h2 id="4-설계-시-고려사항">4. 설계 시 고려사항</h2>
<ol>
<li>
<p><strong>샤드 키 선정</strong></p>
<ul>
<li>조회·갱신 패턴을 분석해 자주 함께 조회되는 데이터가 같은 샤드에 있도록 설계</li>
</ul>
</li>
<li>
<p><strong>데이터 균형 분산(Balancing)</strong></p>
<ul>
<li>샤드 간 데이터 크기·트래픽 부하가 최대한 균등하도록 조정</li>
</ul>
</li>
<li>
<p><strong>분산 트랜잭션 처리</strong></p>
<ul>
<li>애플리케이션에서 분산 트랜잭션을 최소화하거나, Saga 패턴·2PC 등 적절한 분산 커밋 방식 적용</li>
</ul>
</li>
<li>
<p><strong>장애 복구 전략</strong></p>
<ul>
<li>각 샤드 백업 주기, 복제(replica) 설정, 페일오버(failover) 정책 수립</li>
</ul>
</li>
</ol>
<hr>
<h3 id="요약">요약</h3>
<p>DB 샤딩은 대규모 데이터를 수평적으로 분산 저장해 성능과 가용성을 높이는 필수 설계 기법입니다.
하지만 잘못된 샤드 키나 불충분한 운영·모니터링 없이 도입하면 오히려 복잡도와 위험만 늘어나므로, <strong>사전 분석</strong>과 <strong>충분한 테스트</strong>가 꼭 필요합니다.</p>
<p>실무적으로 DB 샤딩을 도입·운영하려면 크게 다음과 같은 단계와 고려사항을 거쳐야 합니다.</p>
<hr>
<h2 id="1-요구사항-분석-및-전략-수립">1. 요구사항 분석 및 전략 수립</h2>
<ol>
<li>
<p><strong>비즈니스·데이터 특성 파악</strong></p>
<ul>
<li>하루 읽기·쓰기 요청량, 데이터 성장 추이, 피크 트래픽 패턴 등을 수집</li>
<li>어떤 테이블(혹은 컬렉션)에 부하가 집중되는지 확인</li>
</ul>
</li>
<li>
<p><strong>샤딩 목표 정리</strong></p>
<ul>
<li>쓰기 처리량 증대 vs. 읽기 처리량 증대 vs. 대용량 저장소 확장 중 우선순위 결정</li>
<li>장애 허용 범위 및 복제(Replication) 전략 수립</li>
</ul>
</li>
</ol>
<hr>
<h2 id="2-샤드-키sharding-key-설계">2. 샤드 키(Sharding Key) 설계</h2>
<ul>
<li>
<p><strong>핫스팟(Hot Spot) 방지</strong></p>
<ul>
<li>균등 분산을 위해 요청 분포가 고르게 퍼지는 컬럼을 선택</li>
<li>예: 해시 기반 샤딩이라면 <code>user_id % N</code>, 범위 샤딩이라면 가입일자와 같이 분산될 수 있는 값</li>
</ul>
</li>
<li>
<p><strong>쿼리 패턴 고려</strong></p>
<ul>
<li>자주 함께 조회·조인되는 데이터는 같은 샤드에 두도록 설계(예: 사용자 프로필과 주문 내역)</li>
</ul>
</li>
<li>
<p><strong>확장성 확보</strong></p>
<ul>
<li>향후 샤드 노드 추가 시 최소한의 데이터 이동으로도 리밸런싱이 가능하도록(Consistent Hashing 등)</li>
</ul>
</li>
</ul>
<hr>
<h2 id="3-샤딩-아키텍처-구성">3. 샤딩 아키텍처 구성</h2>
<ol>
<li>
<p><strong>샤드 노드 구성</strong></p>
<ul>
<li>물리 서버 또는 클라우드 인스턴스에 데이터베이스 인스턴스를 배포</li>
<li>각 샤드는 독립된 Master–Slave(또는 Primary–Replica) 구성으로 장애 대책 마련</li>
</ul>
</li>
<li>
<p><strong>라우팅 계층(Routing Layer)</strong></p>
<ul>
<li>
<p>애플리케이션 내 샤드 키 기반 분기 로직 구현</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// 예시: Java에서 MySQL 샤딩</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kt">int</span><span class="w"> </span><span class="n">shardCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">4</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kt">int</span><span class="w"> </span><span class="n">shardId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userId</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">shardCount</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">DataSource</span><span class="w"> </span><span class="n">ds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataSources</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">shardId</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div></li>
<li>
<p>또는 ProxySQL, HAProxy, Mycat, Vitess 같은 샤딩 프록시 솔루션 도입</p>
</li>
</ul>
</li>
<li>
<p><strong>메타데이터 관리</strong></p>
<ul>
<li>샤드별 위치, 범위, 상태 정보를 담은 메타테이블 또는 ZooKeeper·etcd 같은 분산 키–값 저장소에 관리</li>
</ul>
</li>
</ol>
<hr>
<h2 id="4-데이터-마이그레이션--초기-로드">4. 데이터 마이그레이션 &amp; 초기 로드</h2>
<ul>
<li>
<p><strong>신규 서비스라면</strong></p>
<ul>
<li>애플리케이션 배포 전 미리 샤드별로 빈 테이블 생성</li>
<li>초기 데이터 로드 스크립트를 병렬 실행</li>
</ul>
</li>
<li>
<p><strong>기존 단일 DB에서 이전할 경우</strong></p>
<ol>
<li>
<p><strong>오프라인 마이그레이션</strong>: 서비스 중단이 허용될 때 일괄 추출·삽입</p>
</li>
<li>
<p><strong>온라인 마이그레이션</strong>:</p>
<ul>
<li>CDC(Change Data Capture) 도구(Debezium, Maxwell’s Daemon 등)로 실시간 복제</li>
<li>점진적으로 트래픽을 샤드 클러스터로 전환</li>
<li>최종 Cut-over 시점에 레플리카 싱크를 확인 후 스위칭</li>
</ul>
</li>
</ol>
</li>
</ul>
<hr>
<h2 id="5-분산-트랜잭션--쿼리-처리">5. 분산 트랜잭션 &amp; 쿼리 처리</h2>
<ul>
<li>
<p><strong>트랜잭션 단위 최소화</strong></p>
<ul>
<li>가능하면 단일 샤드 내에서 처리가능하도록 서비스 로직 재구성</li>
</ul>
</li>
<li>
<p><strong>분산 트랜잭션</strong></p>
<ul>
<li>꼭 필요할 때만 Saga 패턴(보상 트랜잭션)·Two-Phase Commit 사용</li>
</ul>
</li>
<li>
<p><strong>조인·집계 쿼리</strong></p>
<ul>
<li>샤드별 로컬 집계를 수행한 뒤 애플리케이션 레벨에서 합산</li>
<li>Spark, Presto 등 분산 쿼리 엔진 연동 검토</li>
</ul>
</li>
</ul>
<hr>
<h2 id="6-모니터링운영">6. 모니터링·운영</h2>
<ul>
<li>
<p><strong>샤드 상태·성능 모니터링</strong></p>
<ul>
<li>각 샤드의 CPU·메모리·디스크 I/O, 네트워크 지표 수집(Prometheus + Grafana 등)</li>
<li>샤드별 쿼리 지연(latency)·QPS·Lock Wait 지표 감시</li>
</ul>
</li>
<li>
<p><strong>자동 리밸런싱</strong></p>
<ul>
<li>Consistent Hashing 기반 솔루션 사용 시 노드 추가·삭제 시 자동 균형 조정</li>
<li>수동 리밸런싱일 경우, 오프라인 스크립트 또는 온라인 툴(pt-reshard for Percona 등) 활용</li>
</ul>
</li>
<li>
<p><strong>백업·복구 정책</strong></p>
<ul>
<li>샤드별 스냅샷(S3, GCS)·WAL(Write-Ahead Log) 보관</li>
<li>장애 발생 시 특정 샤드만 복구 가능하도록 절차 문서화</li>
</ul>
</li>
</ul>
<hr>
<h2 id="7-대표적-오픈소스상용-솔루션">7. 대표적 오픈소스·상용 솔루션</h2>
<table>
  <thead>
      <tr>
          <th>종류</th>
          <th>예시</th>
          <th>특징</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>프록시 기반</td>
          <td>ProxySQL, Mycat, Vitess</td>
          <td>애플리케이션 수정 최소, 프록시에서 라우팅 관리</td>
      </tr>
      <tr>
          <td>DB 내장 샤딩</td>
          <td>MongoDB, Cassandra, Citus</td>
          <td>DB 자체에서 샤딩·복제 관리, 운영 복잡도 다소 높음</td>
      </tr>
      <tr>
          <td>미들웨어·플랫폼</td>
          <td>Sharding-Sphere, Apache Trafodion</td>
          <td>다양한 DB 지원, 복잡한 분산 트랜잭션 지원</td>
      </tr>
  </tbody>
</table>
<hr>
<h3 id="실무-팁">실무 팁</h3>
<ul>
<li><strong>테스트 환경 구축</strong>: 실제 운영과 동일한 샤드 구성으로 부하 테스트·장애 시나리오 연습</li>
<li><strong>점진적 적용</strong>: 우선 부하가 가장 높은 몇 개 테이블만 부분 샤딩 후, 점차 확장</li>
<li><strong>문서화</strong>: 샤드 키, 라우팅 로직, 장애 복구 절차 등 기술 문서를 반드시 유지</li>
</ul>
<hr>
<p>이처럼 DB 샤딩은 단순 분산만이 아닌, <strong>설계 ⇒ 구현 ⇒ 마이그레이션 ⇒ 운영</strong> 전 과정을 종합적으로 관리해야 하며, 특히 샤드 키 선정과 장애 대비 전략이 성패를 좌우합니다. 회사를 비롯한 실제 서비스 환경에서는 위 가이드라인을 팀·서비스 특성에 맞춰 세부 조정을 거치는 것이 중요합니다.</p>
<p>샤딩을 구현할 때 “테이블 템플릿(구조)은 동일하게 유지하되, 물리적으로는 여러 개의 스키마나 데이터베이스에 똑같은 테이블을 복제해서 분산 저장”하는 방식이 많이 쓰입니다. 다만 실제로는 스키마 단위보다는 데이터베이스 인스턴스(혹은 노드) 단위로 나누는 게 보편적이고, 그 아래에 각각의 스키마(혹은 네임스페이스)를 두는 형태로 운영합니다.</p>
<hr>
<h2 id="1-스키마-기반-샤딩또는-스키마-별-분할의-개념">1. 스키마 기반 샤딩(또는 스키마 별 분할)의 개념</h2>
<ul>
<li><strong>같은 테이블 설계(DDL)를</strong> 유지하면서,</li>
<li><strong>샤드 키(예: user_id % N 등)에 따라</strong> 각각 다른 스키마(또는 데이터베이스)로 라우팅</li>
<li>각 스키마에는 동일한 테이블명이지만 서로 다른 데이터 범위만 저장</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">샤드 수 N = 3일 때
</span></span><span class="line"><span class="cl">shard_0 스키마 → users 테이블: user_id % 3 == 0
</span></span><span class="line"><span class="cl">shard_1 스키마 → users 테이블: user_id % 3 == 1
</span></span><span class="line"><span class="cl">shard_2 스키마 → users 테이블: user_id % 3 == 2
</span></span></code></pre></div><p>이렇게 하면 애플리케이션 레이어나 샤딩 프록시가 “‘users’ 테이블에 접근하라”는 쿼리를 샤드 키로 분석해 적절한 스키마·노드로 분기해 줍니다.</p>
<hr>
<h2 id="2-스키마-단위-대신-데이터베이스인스턴스-단위-운영이-많은-이유">2. 스키마 단위 대신 데이터베이스(인스턴스) 단위 운영이 많은 이유</h2>
<ol>
<li>
<p><strong>격리(Isolation)</strong></p>
<ul>
<li>같은 데이터베이스 인스턴스 내 여러 스키마는 자원(CPU, 메모리, I/O)을 공유 → 노드 장애 시 전체 스키마 영향</li>
<li>반면, 인스턴스 단위 분할은 물리적·논리적으로 완전 격리 가능</li>
</ul>
</li>
<li>
<p><strong>운영 편의성</strong></p>
<ul>
<li>백업·복제·장애조치(Failover) 설정을 인스턴스 단위로 관리</li>
<li>모니터링·알림 체계도 인스턴스별로 분리해 구성</li>
</ul>
</li>
<li>
<p><strong>확장성</strong></p>
<ul>
<li>샤드 추가·삭제 시 새로운 DB 인스턴스만 늘리거나 줄이면 되고, 스키마 단위보다 리밸런싱을 더 수월</li>
</ul>
</li>
</ol>
<hr>
<h2 id="3-스키마-기반-샤딩이-유용할-때">3. 스키마 기반 샤딩이 유용할 때</h2>
<ul>
<li><strong>테스트·개발 환경</strong>에서 샤드 구성을 모사할 때</li>
<li><strong>초기 PoC</strong>로 간단히 분산 효과만 확인하고 싶을 때</li>
<li><strong>동일 인스턴스 내 자원 활용</strong>이 충분하고, 완전한 장애 격리가 필요 없을 때</li>
</ul>
<p>하지만 운영 환경에서는 보통 <strong>“샤드당 별도 DB 인스턴스 + 동일한 스키마 템플릿”</strong> 형태로 구성한 뒤,
Mycat, Vitess, ProxySQL 같은 미들웨어나 애플리케이션 레이어에서 라우팅하는 방식을 주로 채택합니다.</p>
<hr>
<h3 id="요약-1">요약</h3>
<ul>
<li>테이블 구조는 동일하게, 물리적 저장소를 스키마별(혹은 DB 인스턴스별)로 분리하는 게 기본 개념</li>
<li>운영 환경에선 스키마 단위보다는 별도 데이터베이스 인스턴스 단위로 샤드를 나누는 경우가 일반적</li>
<li>스키마 기반 샤딩은 소규모·테스트용, 또는 내부 리소스 활용이 충분한 경우에만 권장</li>
</ul>
<p>이처럼 “같은 구조 테이블을 여러 스키마에 분산”하는 건 샤딩의 한 형태지만, 실제 운영에서는 완전한 격리와 확장성을 위해 <strong>샤드별 별도 DB 인스턴스 + 동일 스키마 템플릿</strong> 조합을 더 많이 사용합니다.</p>
</article>
              </div>

              
            </div>
          </div>
        </div>
      </div>

      <div class="pagination-nav">
        <div class="pagination-button next-post">
          
        </div>
        
        <div class="pagination-button previous-post">
          
          <a class="pagination-link link-reverse" href="https://pink-spider.github.io/post/spring/h2_mysql_function/">H2에서 mysql function 쓰려면&nbsp;</a><div> »</div>
          
        </div>
      </div>
    </div>
  </main>
</div>
<script type="application/javascript" src='https://pink-spider.github.io/js/toc.js'></script>
<link rel="stylesheet" href='https://pink-spider.github.io/css/toc.css' />

<div id="gitalk-container" class="gitalk-container"></div>
<link rel="stylesheet" href='https://pink-spider.github.io/css/gitalk.css'>
<script src='https://pink-spider.github.io/js/gitalk.min.js'></script>
<script>
  const gitalk = new Gitalk({
    accessToken: '',
    repo: 'pink-spider.github.io',
    owner: 'pink-spider',
    admin: ['pink-spider'],
    id: eval("location.pathname"), 
    distractionFreeMode: false 
  });
  (function() {
    gitalk.render('gitalk-container');
  })();
</script>


  <div class="footer container-xl width-full p-responsive">
  <div
    class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-sm-items-center pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light"
  >
    <ul
      class="list-style-none d-flex flex-wrap col-12 flex-justify-center mb-2 mb-lg-0"
    >
      
    </ul>
  </div>
  <div class="d-flex flex-justify-center pb-6">
    <span class="f6 text-gray-light"></span>
  </div>
</div>

</body>

<script type="application/javascript" src="https://pink-spider.github.io/js/github-style.js"></script>

<script src="https://pink-spider.github.io/js/mark.es6.min.js"></script>


<script type="text/javascript">

  const host = window.location.host;
  const keyword = localStorage.getItem('keyword');
  localStorage.removeItem('keyword');

  if (keyword) {
    const markInstance = new Mark(document.body);
    markInstance.unmark({
      done: function() {
        markInstance.mark(keyword);
      }
    });
  }

  const primaryColor = getComputedStyle(document.documentElement).getPropertyValue('--color-bg-primary');
  const mutedColor = getComputedStyle(document.documentElement).getPropertyValue('--color-fg-muted');
  const hoverColor = '#216EEB';

  let originalStyle;
  let svgOriginalStyle;
  let titleOriginalStyle;

  const onMouseOver = (node) => {
    originalStyle = Object.assign({}, node.style);
    node.style.backgroundColor = hoverColor;

    const child = node.querySelector('.js-jump');
    child.classList.remove('d-on-nav-focus');

    const title = node.querySelector('.title');
    if (title && primaryColor === ' #fff') {
      titleOriginalStyle = title.style;
      title.style.color = '#fff';
    }

    const svg = node.querySelector('.octicon');
    if (svg) {
      svgOriginalStyle = svg.style;
      svg.style.color = '#fff';
    }
  }

  const onMouseLeave = (node) => {
    node.style = originalStyle;
    const child = node.querySelector('.js-jump');
    child.classList.add('d-on-nav-focus');

    const title = node.querySelector('.title');
    title.style = titleOriginalStyle;

    const svg = node.querySelector('.octicon');
    svg.style = svgOriginalStyle;
  }

  const createSearchItem = (title, link, index) => {
    return `
    <li class="color-bg-primary search-item d-flex flex-justify-start flex-items-center p-0 f5 navigation-item js-navigation-item js-jump-to-scoped-search"
        role="option" aria-selected="false" tabindex="${index}">
        <a onmouseover="onMouseOver(this)" onmouseleave="onMouseLeave(this)"
          class="no-underline d-flex flex-auto flex-items-center jump-to-suggestions-path js-jump-to-suggestion-path js-navigation-open p-2"
          href="${link}" data-item-type="scoped_search">
          <div class="jump-to-octicon js-jump-to-octicon flex-shrink-0 mr-2 text-center ">
            <svg title="Repository" aria-label="Repository" role="img" height="16" viewBox="0 0 16 16"
              version="1.1" width="16" data-view-component="true"
              class="octicon octicon-repo js-jump-to-octicon-repo  flex-shrink-0">
              <path fill-rule="evenodd"
                d="M2 2.5A2.5 2.5 0 014.5 0h8.75a.75.75 0 01.75.75v12.5a.75.75 0 01-.75.75h-2.5a.75.75 0 110-1.5h1.75v-2h-8a1 1 0 00-.714 1.7.75.75 0 01-1.072 1.05A2.495 2.495 0 012 11.5v-9zm10.5-1V9h-8c-.356 0-.694.074-1 .208V2.5a1 1 0 011-1h8zM5 12.25v3.25a.25.25 0 00.4.2l1.45-1.087a.25.25 0 01.3 0L8.6 15.7a.25.25 0 00.4-.2v-3.25a.25.25 0 00-.25-.25h-3.5a.25.25 0 00-.25.25z">
              </path>
            </svg>
          </div>    

          <div
            class="title jump-to-suggestion-name js-jump-to-suggestion-name flex-auto overflow-hidden text-left no-wrap css-truncate css-truncate-target">
            ${title}
          </div>

          <div aria-hidden="true" style="color: var(--color-fg-muted);"
            class="color-bg-primary js-jump border rounded-2 flex-shrink-0 color-bg-subtle px-1 ml-1 f6 d-on-nav-focus js-jump-to-badge-jump">
            Jump to
            <span class="d-inline-block ml-1 v-align-middle">↵</span>
          </div>
        </a>
      </li>
    `
  }

  const createGoogleSearchItem = (keyword) => {
    return `
    <li class="color-bg-primary search-item d-flex flex-justify-start flex-items-center p-0 f5 navigation-item js-navigation-item js-jump-to-scoped-search"
        role="option" aria-selected="false" tabindex="0">
        <a onmouseover="onMouseOver(this)" onmouseleave="onMouseLeave(this)"
          class="no-underline d-flex flex-auto flex-items-center jump-to-suggestions-path js-jump-to-suggestion-path js-navigation-open p-2"
          href="https://www.google.com/search?q=${keyword}" target="_blank" data-item-type="scoped_search">
          <div class="jump-to-octicon js-jump-to-octicon flex-shrink-0 mr-2 text-center ">
            <svg title="Search" aria-label="Search" role="img" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-search js-jump-to-octicon-search flex-shrink-0">
                <path fill-rule="evenodd" d="M11.5 7a4.499 4.499 0 11-8.998 0A4.499 4.499 0 0111.5 7zm-.82 4.74a6 6 0 111.06-1.06l3.04 3.04a.75.75 0 11-1.06 1.06l-3.04-3.04z"></path>
            </svg>
          </div>    

          <div
            class="title jump-to-suggestion-name js-jump-to-suggestion-name flex-auto overflow-hidden text-left no-wrap css-truncate css-truncate-target">
            ${keyword}
          </div>

          <div aria-hidden="true" style="color: var(--color-fg-muted);"
            class="color-bg-primary js-jump border rounded-2 flex-shrink-0 color-bg-subtle px-1 ml-1 f6 d-on-nav-focus js-jump-to-badge-jump">
            Google search
            <span class="d-inline-block ml-1 v-align-middle">↵</span>
          </div>
        </a>
      </li>
    `
  }

  const stripHtml = (html) => {
    let tmp = document.createElement('div');
    tmp.innerHTML = html;

    
    const styles = tmp.getElementsByTagName('style');
    while(styles[0]) {
      styles[0].parentNode.removeChild(styles[0]);
    }

    
    const scripts = tmp.getElementsByTagName('script');
    while(scripts[0]) {
      scripts[0].parentNode.removeChild(scripts[0]);
    }
    
    return tmp.textContent || tmp.innerText || "";
  }

  const inputDom = document.querySelector(".Header-search-input");
  const resultDom = document.getElementById('jump-to-results');
  let debounceTimer;
  let parser;
  let xmlDoc;

  const search = (_keyword) => {

    resultDom.innerHTML = '';

    const keyword = _keyword;

    if (!keyword) return;

    const progressDom = document.getElementById('search-progress');
    if (progressDom && progressDom.classList.contains('d-none')) {
      progressDom.classList.remove('d-none');
    }

    localStorage.setItem('keyword', keyword);
    fetch(`${host.indexOf('localhost') > -1 ? 'http://' : 'https://'}${host}/index.xml`).then(resp => resp.text()).then(async (res) => {
      parser = new DOMParser();
      xmlDoc = parser.parseFromString(res, 'text/xml');
      const linkResult = xmlDoc.getElementsByTagName('link');
      const titleResult = xmlDoc.getElementsByTagName('title');
      const arr = [];

      const matched = [];
      await (async function searchLink() {
        for (let i = 0; i < linkResult.length; i++) {
          await fetch(linkResult[i].textContent).then(resp => resp.text().then(res => {
            const pureText = stripHtml(res);
            if (pureText.indexOf(keyword) >= 0) {
              matched.push(i);
            }
          }))
        }
      })();

      const googleSearchItem = createGoogleSearchItem(keyword);
      const node= document.createRange().createContextualFragment(googleSearchItem);
      resultDom.appendChild(node);

      matched.map((itemIndex, index) => {
        const r = createSearchItem(titleResult[itemIndex].textContent, linkResult[itemIndex].textContent, index + 1);
        const node = document.createRange().createContextualFragment(r);
        resultDom.appendChild(node);
      });

      if (progressDom && !progressDom.classList.contains('d-none')) {
        progressDom.classList.add('d-none');
      }
    });
  }

  const debounce = (callback, time) => {
    window.clearTimeout(debounceTimer);
    debounceTimer = window.setTimeout(callback, time);
  };

  ['focus', 'input'].forEach(event => {
    inputDom.addEventListener(event, (e) => {
      debounce(() => search(e.target.value), 500);
    }, false);
  });

  inputDom.addEventListener('blur', () => {
    setTimeout(() => {
      resultDom.innerHTML = '';
    }, 100);
  });

</script>






</html>