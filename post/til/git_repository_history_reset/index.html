<!DOCTYPE html>
<html lang="ko-KR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width" />
  <script
    type="application/javascript"
    src='https://pink-spider.github.io/js/theme-mode.js'
  ></script>
  <link rel="stylesheet" href='https://pink-spider.github.io/css/frameworks.min.css' />
  <link rel="stylesheet" href='https://pink-spider.github.io/css/github.min.css' />
  <link rel="stylesheet" href='https://pink-spider.github.io/css/github-style.css' />
  <link rel="stylesheet" href='https://pink-spider.github.io/css/light.css' />
  <link rel="stylesheet" href='https://pink-spider.github.io/css/dark.css' />
  <link rel="stylesheet" href='https://pink-spider.github.io/css/syntax.css' />
  
  <link rel="stylesheet" href="/your%20css%20file%20name" />
  
  <title>
    git history 전부 없애고 reset 하는 방법 | Pink Spider
  </title>
  
  <link rel="icon" type="image/x-icon" href="/images/logo_pinkspider.png" />
  
  <meta name="theme-color" content="#1e2327" />

  
  <meta
  name="description"
  content="git history 전부 없애고 reset 하는 방법 git history 를 왜 없애야 할까? 자주있는 일은 아니지만, git history를 전부 날리고 reset 해야 할 때가 있습니다.. 예를 들어, 서버의 비밀번호나 암복호화 key, 개인정보 등 노출되면 민감정보나 파일등이 git에 올라가 버렸다면? 해당 내용을 지우고 다시 commit &amp; push를 했지만, history를 보고 이전 commit을 불러오면 그만이므로, 해결책이 될 수 없지요. 아예 history까지 날려버려서 이전의 실수(꼭 실수했을때만 reset 한다고 할 수는 없지만)를 이력까지 지웁시다. main 혹은 develop등 남겨놓을 브랜치에서 (여기선 main) &ndash;orphan 은 기존커밋 이력없이&hellip;의 의미입니다. 즉, 기존 이력없이 시작하는 브랜치를 하나 만듭니다. git checkout --orphan latest_branch 새로 커밋 git add . git commit -m &#34;initial commit after reset&#34; 기존 브랜치 날리고 새로 만듦 git branch -D main git branch -m main main에 force push하고 불필요한 내용 정리해서 repo 최적화 git push -f origin main git gc --aggressive --prune=all "
/>
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://pink-spider.github.io/post/til/git_repository_history_reset/" />


<meta name="twitter:card" content="summary" />
<meta
  name="twitter:title"
  content="git history 전부 없애고 reset 하는 방법 - Pink Spider"
/>
<meta
  name="twitter:description"
  content="git history 전부 없애고 reset 하는 방법 git history 를 왜 없애야 할까? 자주있는 일은 아니지만, git history를 전부 날리고 reset 해야 할 때가 있습니다.. 예를 들어, 서버의 비밀번호나 암복호화 key, 개인정보 등 노출되면 민감정보나 파일등이 git에 올라가 버렸다면? 해당 내용을 지우고 다시 commit &amp; push를 했지만, history를 보고 이전 commit을 불러오면 그만이므로, 해결책이 될 수 없지요. 아예 history까지 날려버려서 이전의 실수(꼭 실수했을때만 reset 한다고 할 수는 없지만)를 이력까지 지웁시다. main 혹은 develop등 남겨놓을 브랜치에서 (여기선 main) &ndash;orphan 은 기존커밋 이력없이&hellip;의 의미입니다. 즉, 기존 이력없이 시작하는 브랜치를 하나 만듭니다. git checkout --orphan latest_branch 새로 커밋 git add . git commit -m &#34;initial commit after reset&#34; 기존 브랜치 날리고 새로 만듦 git branch -D main git branch -m main main에 force push하고 불필요한 내용 정리해서 repo 최적화 git push -f origin main git gc --aggressive --prune=all "
/>
<meta name="twitter:site" content="https://pink-spider.github.io/" />
<meta name="twitter:creator" content="" />
<meta
  name="twitter:image"
  content="https://pink-spider.github.io/"
/>


<meta
  property="og:type"
  content="article"
/>
<meta
  property="og:title"
  content="git history 전부 없애고 reset 하는 방법 - Pink Spider"
/>
<meta
  property="og:description"
  content="git history 전부 없애고 reset 하는 방법 git history 를 왜 없애야 할까? 자주있는 일은 아니지만, git history를 전부 날리고 reset 해야 할 때가 있습니다.. 예를 들어, 서버의 비밀번호나 암복호화 key, 개인정보 등 노출되면 민감정보나 파일등이 git에 올라가 버렸다면? 해당 내용을 지우고 다시 commit &amp; push를 했지만, history를 보고 이전 commit을 불러오면 그만이므로, 해결책이 될 수 없지요. 아예 history까지 날려버려서 이전의 실수(꼭 실수했을때만 reset 한다고 할 수는 없지만)를 이력까지 지웁시다. main 혹은 develop등 남겨놓을 브랜치에서 (여기선 main) &ndash;orphan 은 기존커밋 이력없이&hellip;의 의미입니다. 즉, 기존 이력없이 시작하는 브랜치를 하나 만듭니다. git checkout --orphan latest_branch 새로 커밋 git add . git commit -m &#34;initial commit after reset&#34; 기존 브랜치 날리고 새로 만듦 git branch -D main git branch -m main main에 force push하고 불필요한 내용 정리해서 repo 최적화 git push -f origin main git gc --aggressive --prune=all "
/>
<meta property="og:url" content="https://pink-spider.github.io/post/til/git_repository_history_reset/" />
<meta property="og:site_name" content="git history 전부 없애고 reset 하는 방법" />
<meta
  property="og:image"
  content="https://pink-spider.github.io/"
/>
<meta property="og:image:width" content="2048" />
<meta property="og:image:height" content="1024" />

<meta property="article:published_time" content="2025-03-24 20:18:45 &#43;0900 KST" />















</head>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6329038356545416"
        crossorigin="anonymous"></script>

<body>
  

<style>
  .height-limitation {
    max-height: 300px;
    overflow-y: scroll;
  }

  .loader {
    border: 4px solid #f3f3f3;
    border-bottom: 4px solid var(--color-fg-muted);
    border-radius: 50%;
    width: 30px;
    height: 30px;
    animation: spin 1s linear infinite;
    margin: 0 auto;
  }

  @keyframes spin {
    0% {
      transform: rotate(0deg);
    }
    100% {
      transform: rotate(360deg);
    }
  }
</style>

<div style="position: relative">
  <header
    class="Header js-details-container Details px-3 px-md-4 px-lg-5 flex-wrap flex-md-nowrap open Details--on"
  >
    <div
      class="Header-item mobile-none"
      style="margin-top: -4px; margin-bottom: -4px"
    >
      <a class="Header-link" href="https://pink-spider.github.io/" aria-label="Home">
        <svg
          class="octicon"
          height="32"
          viewBox="0 0 16 16"
          version="1.1"
          width="32"
        >
          <path
            fill-rule="evenodd"
            d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"
          ></path>
        </svg>
      </a>
    </div>
    <div class="Header-item d-md-none">
      <button
        class="Header-link btn-link js-details-target"
        type="button"
        onclick="document.querySelector('#header-search').style.display = document.querySelector('#header-search').style.display == 'none'? 'block': 'none'"
        aria-label="Search"
      >
        <svg
          height="24"
          class="octicon octicon-three-bars"
          viewBox="0 0 16 16"
          version="1.1"
          width="24"
        >
          <path
            fill-rule="evenodd"
            d="M1 2.75A.75.75 0 011.75 2h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 2.75zm0 5A.75.75 0 011.75 7h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 7.75zM1.75 12a.75.75 0 100 1.5h12.5a.75.75 0 100-1.5H1.75z"
          ></path>
        </svg>
      </button>
    </div>
    <div
      style="display: none"
      id="header-search"
      class="Header-item Header-item--full flex-column flex-md-row width-full flex-order-2 flex-md-order-none mr-0 mr-md-3 mt-3 mt-md-0 Details-content--hidden-not-important d-md-flex"
    >
      <div
        class="Header-search header-search flex-auto js-site-search position-relative flex-self-stretch flex-md-self-auto mb-3 mb-md-0 mr-0 mr-md-3 scoped-search site-scoped-search js-jump-to"
      >
        <div class="position-relative">
          <form
            target="_blank"
            action="https://www.google.com/search"
            accept-charset="UTF-8"
            method="get"
            autocomplete="off"
          >
            <label
              class="Header-search-label form-control input-sm header-search-wrapper p-0 js-chromeless-input-container header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center"
            >
              <input
                type="text"
                class="Header-search-input form-control input-sm header-search-input jump-to-field js-jump-to-field js-site-search-focus js-site-search-field is-clearable"
                name="q"
                value=""
                placeholder="Search"
                autocomplete="off"
              />
              <input type="hidden" name="q" value="site:https://pink-spider.github.io/" />
              <div
                class="js-jump-to-suggestions-container jump-to-suggestions overflow-hidden position-absolute"
              >
                <div
                  id="search-progress"
                  class="d-none color-bg-primary no-underline p-2"
                  role="progress"
                  aria-selected="false"
                >
                  <div class="loader"></div>
                </div>

                <ul
                  id="jump-to-results"
                  role="listbox"
                  class="Box border-0 p-0 m-0 js-navigation-container jump-to-suggestions-results-container js-jump-to-suggestions-results-container js-active-navigation-container height-limitation"
                ></ul>
              </div>
            </label>
          </form>
        </div>
      </div>
    </div>

    <div
      class="Header-item Header-item--full flex-justify-center d-md-none position-relative"
    >
      <a class="Header-link" href="https://pink-spider.github.io/" aria-label="Home">
        <svg
          class="octicon octicon-mark-github v-align-middle"
          height="32"
          viewBox="0 0 16 16"
          version="1.1"
          width="32"
        >
          <path
            fill-rule="evenodd"
            d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"
          ></path>
        </svg>
      </a>
    </div>
    <div class="Theme-switcher Header-item" style="margin-right: 0">
      <span
        role="button"
        class="Header-link no-select"
        onclick="switchTheme()"
        style="cursor: pointer"
        aria-label="Switch theme"
      >
        <svg
          style="fill: var(--color-profile-color-modes-toggle-moon)"
          class="no-select"
          viewBox="0 0 16 16"
          version="1.1"
          width="16"
          height="16"
        >
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M4.52208 7.71754C7.5782 7.71754 10.0557 5.24006 10.0557 2.18394C10.0557 1.93498 10.0392 1.68986 10.0074 1.44961C9.95801 1.07727 10.3495 0.771159 10.6474 0.99992C12.1153 2.12716 13.0615 3.89999 13.0615 5.89383C13.0615 9.29958 10.3006 12.0605 6.89485 12.0605C3.95334 12.0605 1.49286 10.001 0.876728 7.24527C0.794841 6.87902 1.23668 6.65289 1.55321 6.85451C2.41106 7.40095 3.4296 7.71754 4.52208 7.71754Z"
          ></path>
        </svg>
      </span>
    </div>
  </header>
</div>

  
<div>
  <main>
    <div class="gisthead pagehead bg-gray-light pb-0 pt-3 mb-4">
      <div class="px-0">
        <div class="mb-3 d-flex px-3 px-md-3 px-lg-5">
          <div class="flex-auto min-width-0 width-fit mr-3">
            <div class="d-flex">
              <div class="d-none d-md-block">
                <a class="avatar mr-2 flex-shrink-0" href="https://pink-spider.github.io/">
                  <img class=" avatar-user"
                    src="/images/logo_pinkspider.png"
                    width="32" height="32" alt="Pink Spider"></a>
              </div>
              <div class="d-flex flex-column">
                <h1 class="break-word f3 text-normal mb-md-0 mb-1">
                  <span class="author">
                    <a href="https://pink-spider.github.io/">Pink Spider</a></span><span
                    class="path-divider">/</span><strong class="css-truncate-target mr-1" style="max-width: 410px"><a
                      href="https://pink-spider.github.io/post/til/git_repository_history_reset/">git history 전부 없애고 reset 하는 방법</a></strong>
                </h1>
                <div class="note m-0">
                  Created <relative-time datetime="Mon, 24 Mar 2025 20:18:45 &#43;0900"
                    class="no-wrap">
                    Mon, 24 Mar 2025 20:18:45 &#43;0900</relative-time>

                  
                  <span class="file-info-divider"></span>
                  Modified <relative-time datetime="Wed, 26 Mar 2025 04:08:41 &#43;0900"
                    class="no-wrap">
                    Wed, 26 Mar 2025 04:08:41 &#43;0900</relative-time>
                  
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container-lg px-3 new-discussion-timeline">
      <div class="repository-content gist-content">
        <div>
          <div class="js-gist-file-update-container js-task-list-container file-box">
            <div id="file-pytest" class="file my-2">
              <div id="post-header" class="file-header d-flex flex-md-items-center flex-items-start sticky-header" style="z-index: 2">
                <div class="file-info d-flex flex-md-items-center flex-items-start flex-order-1 flex-auto">
                  <div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">
                    
                    <summary id="toc-toggle" onclick="clickToc()" class="btn btn-octicon m-0 mr-2 p-2">
                      <svg aria-hidden="true" viewBox="0 0 16 16" height="16" width="16" class="octicon octicon-list-unordered">
                        <path fill-rule="evenodd" d="M2 4a1 1 0 100-2 1 1 0 000 2zm3.75-1.5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zM3 8a1 1 0 11-2 0 1 1 0 012 0zm-1 6a1 1 0 100-2 1 1 0 000 2z"></path>
                      </svg>
                    </summary>
                    <details-menu class="SelectMenu" id="toc-details" style="display: none;">
                      <div class="SelectMenu-modal rounded-3 mt-1" style="max-height: 340px;">
                        <div class="SelectMenu-list SelectMenu-list--borderless p-2" style="overscroll-behavior: contain;" id="toc-list">
                        </div>
                      </div>
                    </details-menu>
                      2899 Words
                    <span class="file-info-divider"></span>
                                        13 min

                  </div>
                  <div class="file-actions flex-order-2 pt-0">
                    
                  </div>
                </div>
              </div>


              <div class="Box-body px-5 pb-5" style="z-index: 1">
                <article class="markdown-body entry-content container-lg"><h1 id="git-history-전부-없애고-reset-하는-방법">git history 전부 없애고 reset 하는 방법</h1>
<ul>
<li>git history 를 왜 없애야 할까?
<ul>
<li>자주있는 일은 아니지만, git history를 전부 날리고 reset 해야 할 때가 있습니다..</li>
<li>예를 들어, 서버의 비밀번호나 암복호화 key, 개인정보 등 노출되면 민감정보나 파일등이 git에 올라가 버렸다면?</li>
<li>해당 내용을 지우고 다시 commit &amp; push를 했지만, history를 보고 이전 commit을 불러오면 그만이므로, 해결책이 될 수 없지요.</li>
<li>아예 history까지 날려버려서 이전의 실수(꼭 실수했을때만 reset 한다고 할 수는 없지만)를 이력까지 지웁시다.</li>
</ul>
</li>
</ul>
<h2 id="main-혹은-develop등-남겨놓을-브랜치에서-여기선-main">main 혹은 develop등 남겨놓을 브랜치에서 (여기선 main)</h2>
<ul>
<li>&ndash;orphan 은 기존커밋 이력없이&hellip;의 의미입니다. 즉, 기존 이력없이 시작하는 브랜치를 하나 만듭니다.
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">git checkout --orphan latest_branch
</span></span></code></pre></div></li>
</ul>
<h2 id="새로-커밋">새로 커밋</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">git add .
</span></span><span class="line"><span class="cl">git commit -m <span class="s2">&#34;initial commit after reset&#34;</span>
</span></span></code></pre></div><h2 id="기존-브랜치-날리고-새로-만듦">기존 브랜치 날리고 새로 만듦</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">git branch -D main
</span></span><span class="line"><span class="cl">git branch -m main
</span></span></code></pre></div><h2 id="main에-force-push하고-불필요한-내용-정리해서-repo-최적화">main에 force push하고 불필요한 내용 정리해서 repo 최적화</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">git push -f origin main
</span></span><span class="line"><span class="cl">git gc --aggressive --prune<span class="o">=</span>all
</span></span></code></pre></div><p><img src="./images/bob_ross.jpg" alt="image"></p>
<p>잠깐만요. 걍 history만 날리면 끝이 아니죠.</p>
<p>이게 어떤 영향을 미치는 지 알아봅시다</p>
<h1 id="이렇게-하면-기존에-main에서-새로-딴-branch는-어떻게-되는가에-대한-gpt-답">이렇게 하면, 기존에 main에서 새로 딴 branch는 어떻게 되는가에 대한 gpt 답</h1>
<ul>
<li>말씀하신 작업 흐름은 <strong><code>main</code> 브랜치를 완전히 리셋하고 새로 만든 뒤 강제로 푸시</strong>하는 절차인데, <!-- raw HTML omitted -->
이 경우 <strong><code>main</code> 브랜치 기반으로 분기된 다른 브랜치들에 어떤 영향을 주는가</strong>는 꽤 중요한 문제죠.</li>
</ul>
<hr>
<h2 id="-다시-한-번-요약-이-명령어들의-의미">🔧 다시 한 번 요약: 이 명령어들의 의미</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 기존 커밋 이력 없는 새 브랜치 생성</span>
</span></span><span class="line"><span class="cl">git checkout --orphan latest_branch
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 모든 파일 스테이징 &amp; 커밋</span>
</span></span><span class="line"><span class="cl">git add .
</span></span><span class="line"><span class="cl">git commit -m <span class="s2">&#34;initial commit after reset&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 기존 main 브랜치 삭제</span>
</span></span><span class="line"><span class="cl">git branch -D main
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 새 orphan 브랜치를 main으로 리네임</span>
</span></span><span class="line"><span class="cl">git branch -m main
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 원격 main을 강제 푸시 (히스토리 덮어쓰기)</span>
</span></span><span class="line"><span class="cl">git push -f origin main
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 정리: 쓰이지 않는 객체 제거</span>
</span></span><span class="line"><span class="cl">git gc --aggressive --prune<span class="o">=</span>all
</span></span></code></pre></div><hr>
<h2 id="-핵심-질문-기존">🧨 핵심 질문: <strong>기존 <code>main</code>에서 분기한 브랜치들은 어떻게 되는가?</strong></h2>
<h3 id="-로컬-분기branch">✅ <strong>로컬 분기(branch)</strong></h3>
<ul>
<li>기존 <code>main</code>에서 분기한 **로컬 브랜치들(<code>dev</code>, <code>feature/xxx</code> 등)**은 여전히 존재하고, 기존 커밋 히스토리를 그대로 유지합니다.</li>
<li>단, <code>main</code> 브랜치가 새 히스토리로 덮여서 <strong>과거의 <code>main</code>과 연결이 끊깁니다</strong>.</li>
<li>이로 인해 <code>main</code>에 rebase하거나 merge하려고 하면 충돌 또는 연결 오류가 날 수 있습니다.</li>
</ul>
<p>📌 <strong>예시 상황</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 기존 dev 브랜치: main에서 분기됨 → 커밋 A-B-C</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 새 main: 커밋 X (완전 다른 히스토리)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># dev에서 merge main 하려 하면?</span>
</span></span><span class="line"><span class="cl">git checkout dev
</span></span><span class="line"><span class="cl">git merge main
</span></span></code></pre></div><p>결과: 충돌 발생 가능성 높음 또는 &ldquo;공통 조상 없음&rdquo; 에러!</p>
<hr>
<h3 id="-원격-저장소의-브랜치들">🌐 <strong>원격 저장소의 브랜치들</strong></h3>
<ul>
<li>원격에 푸시된 <code>feature/*</code>, <code>dev</code> 등은 그대로 유지됨.</li>
<li>다만 <code>main</code>이 강제로 덮여쓰였기 때문에, GitHub나 GitLab 같은 곳에서 <strong>PR 기록이나 브랜치 그래프가 엉켜 보일 수 있음</strong>.</li>
</ul>
<hr>
<h2 id="-시각화-전후-비교">🧩 시각화 (전후 비교)</h2>
<pre tabindex="0"><code>[기존 상태]

main:      A---B---C
             \
dev:          D---E
feature:      F

[orphan 리셋 후]

main:      X   ← 완전 새 커밋
             \
dev:          D---E   ← 여전히 존재하지만 연결은 끊김
</code></pre><hr>
<h2 id="-정리하자면">⚠️ 정리하자면</h2>
<table>
  <thead>
      <tr>
          <th>항목</th>
          <th>영향</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>로컬 분기 브랜치</td>
          <td>남아 있지만 <code>main</code>과 연결 끊김</td>
      </tr>
      <tr>
          <td>원격 브랜치</td>
          <td>삭제 안 됨. 여전히 존재</td>
      </tr>
      <tr>
          <td>병합/rebase 시도</td>
          <td>히스토리 불일치로 충돌 위험</td>
      </tr>
      <tr>
          <td>협업자에게 영향</td>
          <td>협업자들이 <code>main</code>을 기준으로 작업 중이었다면 충격 큼</td>
      </tr>
      <tr>
          <td><code>git gc</code> 영향</td>
          <td>삭제된 커밋이 완전히 제거되며 복구 어려움</td>
      </tr>
  </tbody>
</table>
<hr>
<h2 id="-대안-만약-협업-중이라면">✅ 대안 (만약 협업 중이라면)</h2>
<ul>
<li>완전히 덮기 전에 기존 <code>main</code>을 <code>backup-main</code> 같은 이름으로 남겨두기:</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git branch backup-main
</span></span></code></pre></div><ul>
<li>또는 <code>main</code>을 <code>reset-main</code>으로 새로 만들고 default 브랜치를 바꾸는 방식도 고려할 수 있어요.</li>
</ul>
<hr>
<h1 id="여러명이-협업중인-repository-에서-브랜치-충돌없이-안정되게-초기화하려면">여러명이 협업중인 repository 에서 브랜치 충돌없이 안정되게 초기화하려면?</h1>
<hr>
<h2 id="-목표">🎯 목표</h2>
<ul>
<li><code>main</code> 브랜치 히스토리를 깨끗이 리셋 (예: 민감한 파일 제거, 초기화 등)</li>
<li>기존 브랜치(<code>dev</code>, <code>feature/*</code> 등)는 <strong>그대로 유지</strong></li>
<li><strong>협업자들과 충돌 없이 진행</strong></li>
</ul>
<hr>
<h2 id="-안전한-전략-요약">🛡️ 안전한 전략 요약</h2>
<ol>
<li>✅ 기존 <code>main</code>을 백업 브랜치로 남김</li>
<li>🆕 새로운 orphan 브랜치 생성 (이력 없는 새 시작)</li>
<li>🔁 새 커밋 생성 후, <code>main</code>에 강제 푸시</li>
<li>📢 팀원들에게 공지 (강제 리베이스 or 주의 필요)</li>
<li>🧹 (선택) 나중에 <code>git gc</code>로 정리</li>
</ol>
<hr>
<h2 id="-추천-스크립트-협업-안전-버전">🛠️ 추천 스크립트 (협업 안전 버전)</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 1. 현재 브랜치가 main인지 확인</span>
</span></span><span class="line"><span class="cl">git checkout main
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 2. main 백업 브랜치 생성</span>
</span></span><span class="line"><span class="cl">git checkout -b backup-main-<span class="k">$(</span>date +%Y%m%d<span class="k">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 3. orphan 브랜치로 새 시작</span>
</span></span><span class="line"><span class="cl">git checkout --orphan reset-main
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 4. 기존 트래킹 파일 제거</span>
</span></span><span class="line"><span class="cl">git rm -rf .
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 5. 필요한 파일 추가</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;# 프로젝트 초기화&#34;</span> &gt; README.md
</span></span><span class="line"><span class="cl">git add .
</span></span><span class="line"><span class="cl">git commit -m <span class="s2">&#34;초기화된 main 커밋&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 6. main 이름으로 변경</span>
</span></span><span class="line"><span class="cl">git branch -D main
</span></span><span class="line"><span class="cl">git branch -m main
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 7. 강제 푸시 (주의!)</span>
</span></span><span class="line"><span class="cl">git push -f origin main
</span></span></code></pre></div><blockquote>
<p>💡 강제 푸시 전, GitHub의 기본 브랜치가 <code>main</code>인지 확인하고, 혹시 모를 문제에 대비해 백업 브랜치를 <code>origin</code>에도 푸시해두세요:</p></blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git push origin backup-main-<span class="k">$(</span>date +%Y%m%d<span class="k">)</span>
</span></span></code></pre></div><hr>
<h2 id="-팀원에게-꼭-공지할-사항">📣 팀원에게 꼭 공지할 사항</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">⚠️ [중요] main 브랜치 히스토리가 초기화되었습니다.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">- 기존 main에서 작업하던 feature 브랜치들은 main과 연결이 끊겼습니다.
</span></span><span class="line"><span class="cl">- 새로운 main을 기준으로 작업하려면 다음 중 하나를 선택하세요:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">1. 새 main에서 브랜치를 새로 만들고 코드 복사
</span></span><span class="line"><span class="cl">2. 기존 브랜치 유지 시, rebase 시도 시 충돌 주의
</span></span><span class="line"><span class="cl">3. 필요한 경우 backup-main-YYYYMMDD 브랜치 참고
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">문의사항은 &lt;당신 이름&gt;에게 DM 주세요 🙏
</span></span></code></pre></div><hr>
<h2 id="-기타-팁">📦 기타 팁</h2>
<h3 id="-민감한-파일이-있어서-초기화한-경우라면">🔐 민감한 파일이 있어서 초기화한 경우라면?</h3>
<ul>
<li><code>.gitignore</code>에 해당 파일 추가</li>
<li><a href="https://rtyley.github.io/bfg-repo-cleaner/">BFG Repo-Cleaner</a> 사용 고려</li>
</ul>
<h3 id="-github-actions-pr-기록-등도-리셋됨">👥 GitHub Actions, PR 기록 등도 리셋됨</h3>
<ul>
<li>CI 연동은 다시 설정 필요할 수 있음</li>
<li>PR들은 main 기준이 바뀌면 혼란스러울 수 있음</li>
</ul>
<hr>
<h2 id="-정리">📌 정리</h2>
<table>
  <thead>
      <tr>
          <th>작업</th>
          <th>설명</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>main</code> 백업</td>
          <td>히스토리 복구용 안전장치</td>
      </tr>
      <tr>
          <td><code>--orphan</code> 브랜치</td>
          <td>이력 없는 새 시작</td>
      </tr>
      <tr>
          <td><code>git push -f</code></td>
          <td>기존 히스토리 덮기</td>
      </tr>
      <tr>
          <td>팀원 공지</td>
          <td>가장 중요한 부분 (충돌 방지!)</td>
      </tr>
  </tbody>
</table>
<hr>
<h1 id="팀원들이-충돌-없이-새-main에-맞추는-방법-rebase-cherry-pick-patch-적용-등">팀원들이 충돌 없이 새 main에 맞추는 방법 (rebase, cherry-pick, patch 적용 등)</h1>
<p><code>main</code> 브랜치를 리셋하고 나면, 기존 브랜치들 (<code>dev</code>, <code>feature/xxx</code> 등)이 <strong>이전 <code>main</code>을 기반으로 만들어졌기 때문에</strong>, 새로 리셋된 <code>main</code>과는 <strong>히스토리상 연결 고리가 끊기게 됩니다</strong>. 이때 충돌 없이 팀원들이 새 <code>main</code>에 맞추는 방법을 아래 3가지 전략으로 정리해드릴게요.</p>
<hr>
<h2 id="-상황-요약">✅ 상황 요약</h2>
<ul>
<li>기존 브랜치: <code>main</code>의 과거 이력을 기준으로 분기</li>
<li>현재 <code>main</code>: <code>orphan</code>으로 만든 완전 새로운 히스토리</li>
<li>문제: <code>git rebase main</code> 또는 <code>git merge main</code> → <strong>공통 조상이 없어 충돌</strong></li>
</ul>
<hr>
<h2 id="-선택지-1-안전하고-깔끔한-방식--새-브랜치-만들고-코드-복사-추천">🔧 선택지 1: 안전하고 깔끔한 방식 – 새 브랜치 만들고 코드 복사 (추천)</h2>
<h3 id="절차">절차</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 최신 main 기준으로 새 브랜치 생성</span>
</span></span><span class="line"><span class="cl">git checkout main
</span></span><span class="line"><span class="cl">git pull
</span></span><span class="line"><span class="cl">git checkout -b feature/xxx-reset
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 예전 브랜치에서 작업한 커밋 확인</span>
</span></span><span class="line"><span class="cl">git log feature/xxx --oneline
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 필요한 커밋만 cherry-pick 또는 수동으로 복사</span>
</span></span><span class="line"><span class="cl">git cherry-pick &lt;커밋 해시&gt;
</span></span><span class="line"><span class="cl"><span class="c1"># 또는</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 옛 브랜치 체크아웃해서 코드 복사 후 커밋</span>
</span></span></code></pre></div><h3 id="장점">장점</h3>
<ul>
<li><strong>히스토리 충돌 없음</strong></li>
<li>새로운 main과 <strong>완전 정리된 형태로 재작업 가능</strong></li>
</ul>
<hr>
<h2 id="-선택지-2-cherry-pick-으로-원하는-커밋만-골라오기">🔧 선택지 2: <code>cherry-pick</code> 으로 원하는 커밋만 골라오기</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># main 기반 새 브랜치</span>
</span></span><span class="line"><span class="cl">git checkout main
</span></span><span class="line"><span class="cl">git pull
</span></span><span class="line"><span class="cl">git checkout -b new-feature
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 기존 브랜치 커밋 로그 확인</span>
</span></span><span class="line"><span class="cl">git log old-feature --oneline
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 필요한 커밋만 가져오기</span>
</span></span><span class="line"><span class="cl">git cherry-pick &lt;커밋해시1&gt; &lt;커밋해시2&gt; ...
</span></span></code></pre></div><blockquote>
<p>cherry-pick 시 충돌이 생기면 수동으로 해결 후 <code>git cherry-pick --continue</code> 하시면 됩니다.</p></blockquote>
<hr>
<h2 id="-선택지-3-패치-방식으로-적용-format-patch--am">🔧 선택지 3: 패치 방식으로 적용 (<code>format-patch</code> + <code>am</code>)</h2>
<h3 id="1-기존-브랜치의-커밋을-패치로-저장">1. 기존 브랜치의 커밋을 패치로 저장</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git checkout feature/old
</span></span><span class="line"><span class="cl">git format-patch main  <span class="c1"># main과의 차이만 저장 (기존 main 기준)</span>
</span></span></code></pre></div><p>→ 이러면 <code>0001-some-change.patch</code> 파일들이 생성돼요.</p>
<h3 id="2-새로운-main-브랜치에-패치-적용">2. 새로운 main 브랜치에 패치 적용</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git checkout main
</span></span><span class="line"><span class="cl">git pull
</span></span><span class="line"><span class="cl">git checkout -b new-feature
</span></span><span class="line"><span class="cl">git am 000*.patch
</span></span></code></pre></div><blockquote>
<p>충돌 시 <code>git am --abort</code>로 취소 가능.</p></blockquote>
<hr>
<h2 id="-예시-시나리오">📘 예시 시나리오</h2>
<h3 id="팀원-alice의-기존-브랜치-featurelogin">팀원 Alice의 기존 브랜치 <code>feature/login</code></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Alice가 새 main 기준 브랜치 생성</span>
</span></span><span class="line"><span class="cl">git checkout main
</span></span><span class="line"><span class="cl">git checkout -b feature/login-reset
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 옛 브랜치에서 코드 복사 또는 cherry-pick</span>
</span></span><span class="line"><span class="cl">git cherry-pick a1b2c3d4
</span></span></code></pre></div><p>또는</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 코드만 복사해서 수동 커밋</span>
</span></span><span class="line"><span class="cl">cp -r ../old-repo/feature/login/* .
</span></span><span class="line"><span class="cl">git add .
</span></span><span class="line"><span class="cl">git commit -m <span class="s2">&#34;Re-applied login feature after main reset&#34;</span>
</span></span></code></pre></div><hr>
<h2 id="-팀원-공지-예시">📣 팀원 공지 예시</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">🛠 [Git 브랜치 초기화 안내]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">main 브랜치가 완전히 새로 초기화되었습니다 (히스토리 리셋).
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">기존 브랜치에서 작업하던 분들은 아래 중 하나로 옮겨주세요:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">1️⃣ 새로운 main 기준으로 브랜치 생성
</span></span><span class="line"><span class="cl">2️⃣ 필요한 커밋은 cherry-pick 하거나 수동 복사
</span></span><span class="line"><span class="cl">3️⃣ 이전 브랜치는 삭제하지 마세요! 참고용으로 사용합니다.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">문의: &lt;담당자&gt;
</span></span></code></pre></div><hr>
<h2 id="-요약">💬 요약</h2>
<table>
  <thead>
      <tr>
          <th>방법</th>
          <th>설명</th>
          <th>안정성</th>
          <th>추천</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>새 브랜치 &amp; 코드 복사</td>
          <td>충돌 없음, 깔끔</td>
          <td>★★★★★</td>
          <td>✅ ✅ ✅</td>
      </tr>
      <tr>
          <td><code>cherry-pick</code></td>
          <td>원하는 커밋만 골라 적용</td>
          <td>★★★★☆</td>
          <td>✅</td>
      </tr>
      <tr>
          <td><code>patch</code></td>
          <td>대량 커밋도 가능</td>
          <td>★★★☆☆</td>
          <td>고급 사용 시</td>
      </tr>
  </tbody>
</table>
<hr>
</article>
              </div>

              
            </div>
          </div>
        </div>
      </div>

      <div class="pagination-nav">
        <div class="pagination-button next-post">
          
          <div>«&nbsp;</div><a class="pagination-link link-reverse" href="https://pink-spider.github.io/post/til/github_action_sample/"> github action sample with spring boot</a>
          
        </div>
        
        <div class="pagination-button previous-post">
          
          <a class="pagination-link link-reverse" href="https://pink-spider.github.io/post/book/clean_code_1/">Clean Code 1장&nbsp;</a><div> »</div>
          
        </div>
      </div>
    </div>
  </main>
</div>
<script type="application/javascript" src='https://pink-spider.github.io/js/toc.js'></script>
<link rel="stylesheet" href='https://pink-spider.github.io/css/toc.css' />

<div id="gitalk-container" class="gitalk-container"></div>
<link rel="stylesheet" href='https://pink-spider.github.io/css/gitalk.css'>
<script src='https://pink-spider.github.io/js/gitalk.min.js'></script>
<script>
  const gitalk = new Gitalk({
    accessToken: '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',
    repo: 'pink-spider.github.io',
    owner: 'pink-spider',
    admin: ['pink-spider'],
    id: eval("location.pathname"), 
    distractionFreeMode: false 
  });
  (function() {
    gitalk.render('gitalk-container');
  })();
</script>


  <div class="footer container-xl width-full p-responsive">
  <div
    class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-sm-items-center pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light"
  >
    <ul
      class="list-style-none d-flex flex-wrap col-12 flex-justify-center mb-2 mb-lg-0"
    >
      
    </ul>
  </div>
  <div class="d-flex flex-justify-center pb-6">
    <span class="f6 text-gray-light"></span>
  </div>
</div>

</body>

<script type="application/javascript" src="https://pink-spider.github.io/js/github-style.js"></script>

<script src="https://pink-spider.github.io/js/mark.es6.min.js"></script>


<script type="text/javascript">

  const host = window.location.host;
  const keyword = localStorage.getItem('keyword');
  localStorage.removeItem('keyword');

  if (keyword) {
    const markInstance = new Mark(document.body);
    markInstance.unmark({
      done: function() {
        markInstance.mark(keyword);
      }
    });
  }

  const primaryColor = getComputedStyle(document.documentElement).getPropertyValue('--color-bg-primary');
  const mutedColor = getComputedStyle(document.documentElement).getPropertyValue('--color-fg-muted');
  const hoverColor = '#216EEB';

  let originalStyle;
  let svgOriginalStyle;
  let titleOriginalStyle;

  const onMouseOver = (node) => {
    originalStyle = Object.assign({}, node.style);
    node.style.backgroundColor = hoverColor;

    const child = node.querySelector('.js-jump');
    child.classList.remove('d-on-nav-focus');

    const title = node.querySelector('.title');
    if (title && primaryColor === ' #fff') {
      titleOriginalStyle = title.style;
      title.style.color = '#fff';
    }

    const svg = node.querySelector('.octicon');
    if (svg) {
      svgOriginalStyle = svg.style;
      svg.style.color = '#fff';
    }
  }

  const onMouseLeave = (node) => {
    node.style = originalStyle;
    const child = node.querySelector('.js-jump');
    child.classList.add('d-on-nav-focus');

    const title = node.querySelector('.title');
    title.style = titleOriginalStyle;

    const svg = node.querySelector('.octicon');
    svg.style = svgOriginalStyle;
  }

  const createSearchItem = (title, link, index) => {
    return `
    <li class="color-bg-primary search-item d-flex flex-justify-start flex-items-center p-0 f5 navigation-item js-navigation-item js-jump-to-scoped-search"
        role="option" aria-selected="false" tabindex="${index}">
        <a onmouseover="onMouseOver(this)" onmouseleave="onMouseLeave(this)"
          class="no-underline d-flex flex-auto flex-items-center jump-to-suggestions-path js-jump-to-suggestion-path js-navigation-open p-2"
          href="${link}" data-item-type="scoped_search">
          <div class="jump-to-octicon js-jump-to-octicon flex-shrink-0 mr-2 text-center ">
            <svg title="Repository" aria-label="Repository" role="img" height="16" viewBox="0 0 16 16"
              version="1.1" width="16" data-view-component="true"
              class="octicon octicon-repo js-jump-to-octicon-repo  flex-shrink-0">
              <path fill-rule="evenodd"
                d="M2 2.5A2.5 2.5 0 014.5 0h8.75a.75.75 0 01.75.75v12.5a.75.75 0 01-.75.75h-2.5a.75.75 0 110-1.5h1.75v-2h-8a1 1 0 00-.714 1.7.75.75 0 01-1.072 1.05A2.495 2.495 0 012 11.5v-9zm10.5-1V9h-8c-.356 0-.694.074-1 .208V2.5a1 1 0 011-1h8zM5 12.25v3.25a.25.25 0 00.4.2l1.45-1.087a.25.25 0 01.3 0L8.6 15.7a.25.25 0 00.4-.2v-3.25a.25.25 0 00-.25-.25h-3.5a.25.25 0 00-.25.25z">
              </path>
            </svg>
          </div>    

          <div
            class="title jump-to-suggestion-name js-jump-to-suggestion-name flex-auto overflow-hidden text-left no-wrap css-truncate css-truncate-target">
            ${title}
          </div>

          <div aria-hidden="true" style="color: var(--color-fg-muted);"
            class="color-bg-primary js-jump border rounded-2 flex-shrink-0 color-bg-subtle px-1 ml-1 f6 d-on-nav-focus js-jump-to-badge-jump">
            Jump to
            <span class="d-inline-block ml-1 v-align-middle">↵</span>
          </div>
        </a>
      </li>
    `
  }

  const createGoogleSearchItem = (keyword) => {
    return `
    <li class="color-bg-primary search-item d-flex flex-justify-start flex-items-center p-0 f5 navigation-item js-navigation-item js-jump-to-scoped-search"
        role="option" aria-selected="false" tabindex="0">
        <a onmouseover="onMouseOver(this)" onmouseleave="onMouseLeave(this)"
          class="no-underline d-flex flex-auto flex-items-center jump-to-suggestions-path js-jump-to-suggestion-path js-navigation-open p-2"
          href="https://www.google.com/search?q=${keyword}" target="_blank" data-item-type="scoped_search">
          <div class="jump-to-octicon js-jump-to-octicon flex-shrink-0 mr-2 text-center ">
            <svg title="Search" aria-label="Search" role="img" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-search js-jump-to-octicon-search flex-shrink-0">
                <path fill-rule="evenodd" d="M11.5 7a4.499 4.499 0 11-8.998 0A4.499 4.499 0 0111.5 7zm-.82 4.74a6 6 0 111.06-1.06l3.04 3.04a.75.75 0 11-1.06 1.06l-3.04-3.04z"></path>
            </svg>
          </div>    

          <div
            class="title jump-to-suggestion-name js-jump-to-suggestion-name flex-auto overflow-hidden text-left no-wrap css-truncate css-truncate-target">
            ${keyword}
          </div>

          <div aria-hidden="true" style="color: var(--color-fg-muted);"
            class="color-bg-primary js-jump border rounded-2 flex-shrink-0 color-bg-subtle px-1 ml-1 f6 d-on-nav-focus js-jump-to-badge-jump">
            Google search
            <span class="d-inline-block ml-1 v-align-middle">↵</span>
          </div>
        </a>
      </li>
    `
  }

  const stripHtml = (html) => {
    let tmp = document.createElement('div');
    tmp.innerHTML = html;

    
    const styles = tmp.getElementsByTagName('style');
    while(styles[0]) {
      styles[0].parentNode.removeChild(styles[0]);
    }

    
    const scripts = tmp.getElementsByTagName('script');
    while(scripts[0]) {
      scripts[0].parentNode.removeChild(scripts[0]);
    }
    
    return tmp.textContent || tmp.innerText || "";
  }

  const inputDom = document.querySelector(".Header-search-input");
  const resultDom = document.getElementById('jump-to-results');
  let debounceTimer;
  let parser;
  let xmlDoc;

  const search = (_keyword) => {

    resultDom.innerHTML = '';

    const keyword = _keyword;

    if (!keyword) return;

    const progressDom = document.getElementById('search-progress');
    if (progressDom && progressDom.classList.contains('d-none')) {
      progressDom.classList.remove('d-none');
    }

    localStorage.setItem('keyword', keyword);
    fetch(`${host.indexOf('localhost') > -1 ? 'http://' : 'https://'}${host}/index.xml`).then(resp => resp.text()).then(async (res) => {
      parser = new DOMParser();
      xmlDoc = parser.parseFromString(res, 'text/xml');
      const linkResult = xmlDoc.getElementsByTagName('link');
      const titleResult = xmlDoc.getElementsByTagName('title');
      const arr = [];

      const matched = [];
      await (async function searchLink() {
        for (let i = 0; i < linkResult.length; i++) {
          await fetch(linkResult[i].textContent).then(resp => resp.text().then(res => {
            const pureText = stripHtml(res);
            if (pureText.indexOf(keyword) >= 0) {
              matched.push(i);
            }
          }))
        }
      })();

      const googleSearchItem = createGoogleSearchItem(keyword);
      const node= document.createRange().createContextualFragment(googleSearchItem);
      resultDom.appendChild(node);

      matched.map((itemIndex, index) => {
        const r = createSearchItem(titleResult[itemIndex].textContent, linkResult[itemIndex].textContent, index + 1);
        const node = document.createRange().createContextualFragment(r);
        resultDom.appendChild(node);
      });

      if (progressDom && !progressDom.classList.contains('d-none')) {
        progressDom.classList.add('d-none');
      }
    });
  }

  const debounce = (callback, time) => {
    window.clearTimeout(debounceTimer);
    debounceTimer = window.setTimeout(callback, time);
  };

  ['focus', 'input'].forEach(event => {
    inputDom.addEventListener(event, (e) => {
      debounce(() => search(e.target.value), 500);
    }, false);
  });

  inputDom.addEventListener('blur', () => {
    setTimeout(() => {
      resultDom.innerHTML = '';
    }, 100);
  });

</script>






</html>